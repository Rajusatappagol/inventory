<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stationary Inventory</title>
  <style>
    :root {
      --bg: linear-gradient(135deg,white,white 40%, #e0f2fe 100%);
      --card: rgba(255, 255, 255, 0.85);
      --muted: #64748b;
      --primary: #2563eb;
      --accent: #0ea5e9;
      --danger: #ef4444;
      --success: #10b981;
    }

    body {
      margin: 0;
      font-family: 'Inter', 'Segoe UI', Roboto, Arial;
      background: var(--bg);
      overflow-x: hidden;
      color: #0f172a;
      position: relative;
      min-height: 100vh;
    }

    /* 🌈 Floating Stationary Icons */
    .floating-icon {
      position: absolute;
      font-size: 58px; /* Increased size */
      opacity: 0.18;
      animation: float 10s ease-in-out infinite alternate;
      pointer-events: none;
    }
    .floating-icon:nth-child(1) { top: 8%; left: 6%; animation-delay: 0s; }
    .floating-icon:nth-child(2) { top: 25%; left: 82%; animation-delay: 2s; }
    .floating-icon:nth-child(3) { top: 70%; left: 10%; animation-delay: 4s; }
    .floating-icon:nth-child(4) { top: 55%; left: 65%; animation-delay: 6s; }

    @keyframes float {
      0% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-35px) rotate(8deg); }
      100% { transform: translateY(0px) rotate(-8deg); }
    }

    /* 🌊 Animated Waves */
    .wave {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 200%;
      height: 200px;
      background: rgba(37, 99, 235, 0.1);
      border-radius: 100% 50%;
      animation: wave 8s linear infinite;
      z-index: 0;
    }
    .wave:nth-child(2) {
      background: rgba(14, 165, 233, 0.12);
      animation-delay: -4s;
    }
    @keyframes wave {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* 🔷 Navbar */
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 22px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .navbar .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.1rem;
    }
    .navbar img {
      height: 34px;
      background: #fff;
      border-radius: 6px;
      padding: 4px;
    }

    /* 🧭 Dashboard Button at Right */
    .dashboard-btn {
      background: white;
      color: var(--primary);
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 10px 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      text-decoration: none;
    }
    .dashboard-btn:hover {
      background: var(--accent);
      color: white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }

    .toggle-btn {
      background: var(--primary);
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    .toggle-btn:hover {
      background: var(--accent);
      transform: scale(1.05);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);
    }

    /* 🧾 Form Cards */
    form {
      max-width: 720px;
      margin: 25px auto;
      background: var(--card);
      padding: 28px;
      border-radius: 16px;
      backdrop-filter: blur(14px);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
      transition: all 0.4s ease;
      z-index: 2;
      position: relative;
    }

    .form-title {
      text-align: center;
      font-weight: 700;
      font-size: 1.3rem;
      color: var(--primary);
      margin-bottom: 22px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
    }
    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-bottom: 15px;
    }
    label {
      font-weight: 600;
      margin-bottom: 5px;
      color: #1e293b;
    }
    input, select {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 15px;
      background: rgba(255,255,255,0.85);
      transition: 0.2s;
    }
    input:focus, select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 8px rgba(37, 99, 235, 0.3);
      outline: none;
    }

    /* 📊 Table */
    .stationary-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
    }
    .stationary-table th, .stationary-table td {
      padding: 12px 14px;
      border-bottom: 1px solid #e5e7eb;
    }
    .stationary-table thead th {
      background: #f3f4f6;
      font-weight: 700;
    }
    .stationary-table tbody tr:hover {
      background: #e0f2fe;
      transition: background 0.2s ease;
    }
    
    /* Row editing styles */
    .item-row .edit-mode {
      display: none;
    }
    .item-row .edit-mode input {
      border: 2px solid var(--primary);
      background: rgba(37, 99, 235, 0.05);
    }
    .item-row .actions-cell .edit-mode {
      display: none;
    }

    /* 🧠 Animations */
    .slide-down { animation: slideDown 0.4s ease forwards; }
    .slide-up { animation: slideUp 0.4s ease forwards; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-15px); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* 🎯 Aside Navigation Styles */
    .aside-nav {
      position: fixed;
      top: 80px;
      left: 0;
      width: 220px;
      height: calc(100vh - 80px);
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
      z-index: 5;
      transition: all 0.3s ease;
      border-radius: 0 15px 15px 0;
      overflow: hidden;
    }
    
    .aside-nav.collapsed {
      width: 70px;
    }
    
    .aside-toggle {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
    }
    
    .aside-toggle:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: scale(1.1) rotate(180deg);
      box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
    }
    
    .aside-toggle:active {
      transform: scale(0.95) rotate(180deg);
    }
    
    .aside-nav-content {
      padding: 60px 20px 20px;
      height: 100%;
      overflow-y: auto;
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px 20px;
      margin-bottom: 8px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      position: relative;
      overflow: hidden;
    }
    
    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s ease;
    }
    
    .nav-item:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
      color: white;
      transform: translateX(8px) scale(1.02);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      border-left: 4px solid rgba(255, 255, 255, 0.3);
    }
    
    .nav-item:hover::before {
      left: 100%;
    }
    
    .nav-item:hover .icon {
      transform: scale(1.2) rotate(5deg);
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }
    
    .nav-item:hover .text {
      font-weight: 600;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    
    .nav-item.active {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    .nav-item.active:hover {
      background: linear-gradient(90deg, var(--accent), var(--primary));
      transform: translateX(10px) scale(1.05);
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.4);
    }
    
    .nav-item .icon {
      font-size: 20px;
      min-width: 24px;
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .nav-item .text {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 1;
      visibility: visible;
    }
    
    .aside-nav.collapsed .nav-item .text {
      opacity: 0;
      visibility: hidden;
    }
    
    .aside-nav.collapsed .nav-item {
      justify-content: center;
      padding: 15px 10px;
    }
    
    /* 📊 Enhanced Table Container */
    .table-container {
      background: var(--card);
      border-radius: 16px;
      padding: 0;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .table-header {
      background: linear-gradient(90deg, #f8fafc, #e2e8f0);
      padding: 20px 25px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .table-title {
      color: var(--primary);
      font-weight: 700;
      font-size: 1.2rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .search-box {
      position: relative;
      width: 320px;
    }
    
    .search-input {
      width: 100%;
      padding: 14px 50px 14px 45px;
      border-radius: 12px;
      border: 2px solid #e2e8f0;
      font-size: 15px;
      background: white;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .search-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1), 0 4px 12px rgba(0, 0, 0, 0.1);
      outline: none;
      transform: translateY(-1px);
    }
    
    .search-input:hover {
      border-color: #cbd5e1;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
    }
    
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #64748b;
      font-size: 16px;
      pointer-events: none;
      transition: color 0.3s ease;
    }
    
    .search-input:focus + .search-icon {
      color: var(--primary);
    }
    
    .search-clear {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: #f1f5f9;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 12px;
      color: #64748b;
      display: none;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .search-clear:hover {
      background: #e2e8f0;
      color: var(--danger);
      transform: translateY(-50%) scale(1.1);
    }
    
    .search-clear.show {
      display: flex;
    }
    
    .search-results-count {
      position: absolute;
      right: -10px;
      top: -8px;
      background: var(--primary);
      color: white;
      border-radius: 10px;
      padding: 2px 8px;
      font-size: 11px;
      font-weight: 600;
      min-width: 20px;
      text-align: center;
      display: none;
    }
    
    .search-results-count.show {
      display: block;
    }
    
    /* 📋 Scrollable Table with Fixed Height */
    .table-scroll-container {
      height: 400px;
      overflow-y: auto;
      overflow-x: auto;
      border-bottom: 1px solid #e5e7eb;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) #f1f5f9;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: white;
    }
    
    .table-scroll-container::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .table-scroll-container::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    
    .table-scroll-container::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
      transition: background 0.3s ease;
    }
    
    .table-scroll-container::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
    }
    
    .table-scroll-container table {
      margin-bottom: 0;
      border-radius: 0;
    }
    
    .table-scroll-container thead th {
      position: sticky;
      top: 0;
      background: #f8f9fa;
      z-index: 10;
      border-bottom: 2px solid #dee2e6;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .table-scroll-container tbody tr {
      height: 60px;
      border-bottom: 1px solid #f1f5f9;
    }
    
    .table-scroll-container tbody tr:hover {
      background-color: #f8fafc;
      transition: background-color 0.2s ease;
    }
    
    .stationary-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    
    .stationary-table thead {
      position: sticky;
      top: 0;
      z-index: 2;
    }
    
    .stationary-table th {
      background: #f1f5f9;
      padding: 15px 18px;
      font-weight: 700;
      color: #1e293b;
      border-bottom: 2px solid #e5e7eb;
      text-align: left;
    }
    
    .stationary-table td {
      padding: 15px 18px;
      border-bottom: 1px solid #f1f5f9;
      transition: all 0.2s ease;
    }
    
    .stationary-table tbody tr:hover {
      background: #f0f9ff;
      transform: scale(1.002);
    }
    
    .stationary-table tbody tr:nth-child(even) {
      background: #fafbfc;
    }
    
    .stationary-table tbody tr:nth-child(even):hover {
      background: #f0f9ff;
    }
    
    /* 🎨 Content Area with Aside Compensation */
    .main-content {
      margin-left: 240px;
      transition: margin-left 0.3s ease;
      padding: 20px;
      min-height: calc(100vh - 80px);
    }
    
    .main-content.expanded {
      margin-left: 90px;
    }
    
    /* 🎯 Action Buttons Container */
    .action-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      padding: 20px 0;
      flex-wrap: wrap;
    }
    
    .toggle-btn {
      background: linear-gradient(45deg, var(--primary), var(--accent));
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }
    
    .toggle-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
    }
    
    /* 📱 Responsive Design */
    @media (max-width: 1024px) {
      .aside-nav {
        width: 70px;
      }
      
      .aside-nav .nav-item .text {
        opacity: 0;
        visibility: hidden;
      }
      
      .main-content {
        margin-left: 90px;
      }
      
      .table-scroll-container {
        height: 300px;
      }
      
      .search-box {
        width: 100%;
        max-width: 280px;
      }
      
      .search-input {
        padding: 10px 35px 10px 30px;
        font-size: 14px;
      }
      
      .search-icon {
        left: 10px;
        font-size: 13px;
      }
      
      .search-clear {
        right: 10px;
        width: 20px;
        height: 20px;
        font-size: 10px;
      }
    }
    
    @media (max-width: 768px) {
      .aside-nav {
        transform: translateX(-100%);
        width: 260px;
      }
      
      .aside-nav.mobile-open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        padding: 15px;
      }
      
      .table-header {
        flex-direction: column;
        gap: 15px;
        padding: 20px;
      }
      
      .search-box {
        width: 100%;
        max-width: 300px;
      }
      
      .action-buttons {
        justify-content: center;
      }
      
      .toggle-btn {
        width: 100%;
        max-width: 200px;
      }
      
      .form-row {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <!-- Floating Icons -->
  <div class="floating-icon">✏️</div>
  <div class="floating-icon">🖊️</div>
  <div class="floating-icon">📒</div>
  <div class="floating-icon">📘</div>

  <div class="wave"></div>
  <div class="wave"></div>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="brand">
      <button id="mobileNavToggle" class="dashboard-btn" style="display: none; margin-right: 10px;">☰ Menu</button>
      <img src="https://www.aequs.com/wp-content/uploads/2021/06/Aequs-Logo-new.png" alt="logo">
    </div>
    <a href="/admin/dashboard/" class="dashboard-btn">🏠 Dashboard</a>
  </nav>



  
  <!-- Enhanced Aside Navigation -->
  <aside id="asideNav" class="aside-nav">
    <button class="aside-toggle" id="asideToggle" title="Toggle Navigation">←</button>
    <div class="aside-nav-content">
      <a href="/admin/dashboard/" class="nav-item">
        <span class="icon">🏠</span>
        <span class="text">Dashboard</span>
      </a>
      <a href="#" class="nav-item active" onclick="showStockTable(); return false;">
        <span class="icon">📝</span>
        <span class="text">Stock Items</span>
      </a>
      <a href="#" class="nav-item" onclick="showIssuedTable(); return false;">
        <span class="icon">👤</span>
        <span class="text">Issued Items</span>
      </a>
     
     
     
      </div>
    </div>
  </aside>

  <!-- Main Content Area -->
  <div id="mainContent" class="main-content">
    <!-- Action Buttons -->
    <div class="action-buttons">
      <button id="toggleIssueBtn" type="button" class="toggle-btn">📝 Issue Item</button>
      <button id="toggleStockBtn" type="button" class="toggle-btn">📦 Add Stock</button>
    </div>
{% if messages %}
  <div style="max-width:800px; margin:10px auto;">
    {% for message in messages %}
      <div style="background:#e0f2fe; color:#1e3a8a; border-left:5px solid #2563eb; padding:10px 15px; border-radius:6px; margin-bottom:8px;">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

  <!-- Issue Form -->
  <form id="issueForm" method="POST" action="{% url 'submit_stationary_issue' %}" style="display:none;">
    {% csrf_token %}
    <h2 class="form-title">Stationary Issue Form</h2>
    <div class="form-group">
      <label for="empSelect">Employee ID</label>
      <select id="empSelect" name="empId" required>
        <option value="">Select Employee ID</option>
        {% for emp in employees %}
          <option value="{{ emp.emp_id }}" 
                  data-name="{{ emp.emp_name }}" 
                  data-email="{{ emp.emp_email }}" 
                  data-gender="{{ emp.gender }}" 
                  data-entity="{{ emp.entity }}">
            {{ emp.emp_id }} - {{ emp.emp_name }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group">
      <label>Employee Name</label>
      <input type="text" id="empName" name="empName" readonly>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="empEmail" name="empEmail" readonly>
      </div>
      <div class="form-group">
        <label>Gender</label>
        <input type="text" id="empGender" name="empGender" readonly>
      </div>
      <div class="form-group">
        <label>Entity</label>
        <input type="text" id="empEntity" name="empEntity" readonly>
      </div>
    </div>
    <div class="form-group">
      <label>Stationary Item</label>
      <select id="stationaryItem" name="stationaryItem" required>
        <option value="">Select Item</option>
        {% for item in items %}
          <option value="{{ item.id }}" data-available="{{ item.quantity }}">{{ item.category.name }} (Available: {{ item.quantity }})</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Quantity Issued</label>
        <input type="number" id="quantityIssued" name="quantityIssued" min="1" required>
        <small id="availableQty" style="color: var(--muted); margin-top:5px; display:none;">Available quantity will be shown here</small>
      </div>
      <div class="form-group">
        <label>Issue Date</label>
        <input type="date" id="issueDate" name="issueDate" required>
      </div>
    </div>
    <div style="text-align:center; margin-top:15px;">
      <button type="submit" class="toggle-btn">Submit Issue</button>
    </div>
  </form>

 <!-- Stock Form -->
<form id="stockForm" method="POST" action="{% url 'add_stationary_item' %}" style="display:none;">
  {% csrf_token %}
  <h2 class="form-title">📝 Add or Restock Stationary Items</h2>

  <!-- Option Selection -->
  <div class="form-group" style="margin-bottom:20px;">
    <label>Choose Action</label>
    <div style="display:flex; gap:15px; margin-top:8px;">
      <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
        <input type="radio" name="action_type" value="new" id="addNewRadio" checked>
        <span>➕ Add New Item </span>
      </label>
      <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
        <input type="radio" name="action_type" value="existing" id="addStockRadio">
        <span>📦 Add Stock to Existing </span> 
      </label>
    </div>
  </div>

  <!-- ➕ Add New Stationary Type Section -->
  <div id="newItemSection" class="form-group" style="margin-bottom:20px;">
    <label for="newType">New </label>
    <div style="display:flex; gap:10px;">
      <input type="text" id="newType" name="new_type" placeholder="Enter new item name (e.g., Pens, Notebooks, etc.)">
      <button type="submit" formaction="{% url 'add_stationary_type' %}" class="toggle-btn" style="padding:8px 14px;">
        ➕ Add New 
      </button>
    </div>
    <small style="color: var(--muted); margin-top:5px; display:block;">This will create a new stationary</small>
  </div>

  <div id="existingItemSection" class="form-group" style="display:none; margin-bottom:20px;">
    <label>Select Existing Stationary Item</label>
    <select name="category" id="categorySelect">
      <option value="">Choose an existing item to restock</option>
      {% for t in types %}
        <option value="{{ t.id }}">{{ t.name }}</option>
      {% endfor %}
    </select>
    <small style="color: var(--muted); margin-top:5px; display:block;">Select an item to add more stock to it</small>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>Quantity to Add</label>
      <input type="number" name="quantity" min="1" required placeholder="Enter quantity">
      <small style="color: var(--muted); margin-top:5px; display:block;">Number of units to add to inventory</small>
    </div>
  </div>
  <div style="text-align:center; margin-top:20px;">
    <button type="submit" class="toggle-btn">
      <span id="submitText">📥 Add New Item</span>
    </button>
  </div>
</form>
    <!-- Enhanced Inventory Table -->
    <div id="stockTableContainer" class="table-container">
      <div class="table-header">
        <h2 class="table-title">
          <span>📋</span>
          Stationary Inventory
        </h2>
        <div class="search-box">
          <input 
            type="text" 
            id="searchInput" 
            class="search-input"
            placeholder="Search items, categories, quantities..." 
          />
          <span class="search-icon">🔍</span>
          <button type="button" class="search-clear" id="searchClear">✕</button>
          <span class="search-results-count" id="searchResultsCount">0</span>
        </div>
      </div>
      
      <div class="table-scroll-container">
        <table class="stationary-table">
          <thead>
            <tr>
              <th style="width: 60px;">S/N</th>
              <th>Category</th>
              <th style="text-align: right; width: 120px;">Quantity</th>
              <th style="text-align: right; width: 140px;">Last Updated</th>
              <th style="width: 200px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if items %}
              {% for it in items %}
                <tr id="row-{{ it.id }}" class="item-row">
                  <td style="font-weight: 600; color: var(--primary);">{{ forloop.counter }}</td>
                  <td class="category-cell">
                    <span class="display-mode" style="font-weight: 500;">{{ it.category.name }}</span>
                    <input type="text" class="edit-mode" value="{{ it.category.name }}" style="display:none; width:100%; padding:8px; border-radius:8px; border:1px solid #cbd5e1;">
                  </td>
                  <td style="text-align:right" class="quantity-cell">
                    <span class="display-mode" style="font-weight: 600;" data-quantity="{{ it.quantity }}">{{ it.quantity }}</span>
                    <input type="number" class="edit-mode" value="{{ it.quantity }}" min="0" style="display:none; width:100px; padding:8px; border-radius:8px; border:1px solid #cbd5e1;">
                  </td>
                  <td style="text-align:right; color: var(--muted); font-size: 13px;">{{ it.updated_at|date:"M d, Y H:i" }}</td>
                  <td class="actions-cell">
                    <div class="display-mode">
                      <button type="button" class="toggle-btn edit-btn" style="padding:8px 12px; font-size:12px; margin-right: 6px;" data-item-id="{{ it.id }}">✏️ Edit</button>
                    </div>
                    <div class="edit-mode" style="display:none;">
                      <button type="button" class="toggle-btn save-btn" style="padding:8px 12px; font-size:12px; margin-right:6px; background:var(--success);" data-item-id="{{ it.id }}">💾 Save</button>
                      <button type="button" class="toggle-btn cancel-btn" style="padding:8px 12px; font-size:12px; background:var(--muted);" data-item-id="{{ it.id }}">❌ Cancel</button>
                    </div>
                    
                    <!-- Hidden form for submitting updates -->
                    <form method="POST" action="{% url 'update_stationary_item' it.id %}" style="display:none;" class="update-form">
                      {% csrf_token %}
                      <input type="hidden" name="quantity" class="quantity-input">
                    </form>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="5" style="text-align:center; padding:40px; color:var(--muted);">
                  <div style="font-size: 48px; margin-bottom: 15px;">📦</div>
                  <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No stationary items yet</div>
                  <div style="font-size: 14px;">Click "Add Stock" to add your first item</div>
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
      
      <!-- Table Footer with Summary -->
      <div style="padding: 15px 25px; background: #f8fafc; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
        <div style="color: var(--muted); font-size: 14px;">
          Total Items: <span style="font-weight: 600; color: var(--primary);">{{ items|length }}</span>
        </div>
        <div style="color: var(--muted); font-size: 14px;">
          Showing: <span id="visibleRows" style="font-weight: 600; color: var(--primary);">{{ items|length }}</span> items
        </div>
      </div>
    </div>

    <!-- Enhanced Issued Items Table -->
    <div id="issuedTableContainer" class="table-container" style="display: none;">
      <div class="table-header">
        <h2 class="table-title">
          <span>👤</span>
          Issued Stationary Items
        </h2>
        <div class="search-box">
          <input 
            type="text" 
            id="searchIssuedInput" 
            class="search-input"
            placeholder="Search by employee, item, entity..." 
          />
          <span class="search-icon">🔍</span>
          <button type="button" class="search-clear" id="searchIssuedClear">✕</button>
          <span class="search-results-count" id="searchIssuedResultsCount">0</span>
        </div>
      </div>
      
      <div class="table-scroll-container">
        <table class="stationary-table">
          <thead>
            <tr>
              <th style="width: 60px;">S/N</th>
              <th>Employee ID</th>
              <th>Employee Name</th>
              <th>Email</th>
              <th>Gender</th>
              <th>Entity</th>
              <th>Item</th>
              <th style="text-align: right; width: 100px;">Quantity</th>
              <th style="text-align: right; width: 140px;">Issued Date</th>
            </tr>
          </thead>
          <tbody>
            {% if issued_items %}
              {% for issue in issued_items %}
                <tr class="issued-item-row">
                  <td style="font-weight: 600; color: var(--primary);">{{ forloop.counter }}</td>
                  <td style="font-weight: 500;">{{ issue.emp_id }}</td>
                  <td style="font-weight: 500;">{{ issue.emp_name }}</td>
                  <td style="color: var(--muted); font-size: 13px;">{{ issue.emp_email }}</td>
                  <td style="color: var(--muted); text-transform: capitalize;">{{ issue.gender }}</td>
                  <td style="color: var(--muted); font-size: 12px;">{{ issue.entity|truncatechars:20 }}</td>
                  <td style="font-weight: 500; color: var(--accent);">{{ issue.stationary.category.name }}</td>
                  <td style="text-align: right; font-weight: 600; color: var(--primary);">{{ issue.quantity }}</td>
                  <td style="text-align: right; color: var(--muted); font-size: 13px;">{{ issue.issued_at|date:"M d, Y H:i" }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="9" style="text-align:center; padding:40px; color:var(--muted);">
                  <div style="font-size: 48px; margin-bottom: 15px;">👤</div>
                  <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No items issued yet</div>
                  <div style="font-size: 14px;">Issue items to employees to see them here</div>
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
      
      <!-- Table Footer with Summary -->
      <div style="padding: 15px 25px; background: #f8fafc; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
        <div style="color: var(--muted); font-size: 14px;">
          Total Issues: <span style="font-weight: 600; color: var(--primary);">{{ issued_items|length }}</span>
        </div>
        <div style="color: var(--muted); font-size: 14px;">
          Showing: <span id="visibleIssuedRows" style="font-weight: 600; color: var(--primary);">{{ issued_items|length }}</span> issues
        </div>
      </div>
    </div>
  </div> <!-- End main-content -->

  <script>
    // 🎯 Aside Navigation Controls
    const asideNav = document.getElementById('asideNav');
    const asideToggle = document.getElementById('asideToggle');
    const mainContent = document.getElementById('mainContent');
    const mobileNavToggle = document.getElementById('mobileNavToggle');
    
    // Desktop aside toggle
    asideToggle.addEventListener('click', function() {
      asideNav.classList.toggle('collapsed');
      mainContent.classList.toggle('expanded');
      asideToggle.innerHTML = asideNav.classList.contains('collapsed') ? '→' : '←';
    });
    
    // Mobile navigation toggle
    mobileNavToggle.addEventListener('click', function() {
      asideNav.classList.toggle('mobile-open');
    });
    
    // Close mobile nav when clicking outside
    document.addEventListener('click', function(e) {
      if (window.innerWidth <= 768) {
        if (!asideNav.contains(e.target) && !mobileNavToggle.contains(e.target)) {
          asideNav.classList.remove('mobile-open');
        }
      }
    });
    
    // Show/hide mobile toggle based on screen size
    function updateMobileToggle() {
      if (window.innerWidth <= 768) {
        mobileNavToggle.style.display = 'inline-block';
      } else {
        mobileNavToggle.style.display = 'none';
        asideNav.classList.remove('mobile-open');
      }
    }
    
    window.addEventListener('resize', updateMobileToggle);
    updateMobileToggle();
    
    // � Table View Toggle Functionality
    let currentView = 'stock'; // 'stock' or 'issued'
    
    function showStockTable() {
      document.getElementById('stockTableContainer').style.display = 'block';
      document.getElementById('issuedTableContainer').style.display = 'none';
      currentView = 'stock';
      
      // Update active nav item
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelector('.nav-item[onclick="showStockTable(); return false;"]').classList.add('active');
    }
    
    function showIssuedTable() {
      document.getElementById('stockTableContainer').style.display = 'none';
      document.getElementById('issuedTableContainer').style.display = 'block';
      currentView = 'issued';
      
      // Update active nav item
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelector('.nav-item[onclick="showIssuedTable(); return false;"]').classList.add('active');
    }
    
    // Toggle view button functionality
    const toggleViewBtn = document.getElementById('toggleViewBtn');
    if (toggleViewBtn) {
      toggleViewBtn.addEventListener('click', function() {
        if (currentView === 'stock') {
          showIssuedTable();
          this.innerHTML = '📦 Show Stock';
        } else {
          showStockTable();
          this.innerHTML = '👤 Show Issues';
        }
      });
    }
    
    // Initialize view
    showStockTable();

    // �🔍 Enhanced Search Functionality for Stock Table
    const searchInput = document.getElementById('searchInput');
    const searchClear = document.getElementById('searchClear');
    const searchResultsCount = document.getElementById('searchResultsCount');
    const tableRows = document.querySelectorAll('#stockTableContainer .stationary-table tbody tr:not([colspan])');
    const visibleRowsSpan = document.getElementById('visibleRows');
    
    function updateSearchUI(input, clearBtn, resultCount, visibleCount, totalCount) {
      // Show/hide clear button
      if (input && clearBtn && input.value.trim()) {
        clearBtn.classList.add('show');
      } else if (clearBtn) {
        clearBtn.classList.remove('show');
      }
      
      // Update result count
      if (input && resultCount && input.value.trim() && visibleCount !== totalCount) {
        resultCount.textContent = visibleCount;
        resultCount.classList.add('show');
      } else if (resultCount) {
        resultCount.classList.remove('show');
      }
    }
    
    if (searchInput) {
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        let visibleCount = 0;
        const totalCount = tableRows.length;
        
        tableRows.forEach(row => {
          const categoryText = row.querySelector('.category-cell .display-mode')?.textContent.toLowerCase() || '';
          const quantity = row.querySelector('.quantity-cell .display-mode')?.textContent || '';
          const searchText = `${categoryText} ${quantity}`.toLowerCase();
          
          if (searchText.includes(searchTerm)) {
            row.style.display = '';
            visibleCount++;
          } else {
            row.style.display = 'none';
          }
        });
        
        // Update visible count in footer
        if (visibleRowsSpan) {
          visibleRowsSpan.textContent = visibleCount;
        }
        
        // Update search UI
        updateSearchUI(this, searchClear, searchResultsCount, visibleCount, totalCount);
        
        // Show/hide empty state
        const tbody = document.querySelector('#stockTableContainer .stationary-table tbody');
        const existingNoResults = document.getElementById('no-results');
        
        if (visibleCount === 0 && searchTerm && !existingNoResults) {
          const noResultsRow = document.createElement('tr');
          noResultsRow.id = 'no-results';
          noResultsRow.innerHTML = `
            <td colspan="5" style="text-align:center; padding:40px; color:var(--muted);">
              <div style="font-size: 48px; margin-bottom: 15px;">🔍</div>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No items found</div>
              <div style="font-size: 14px;">Try adjusting your search terms</div>
            </td>
          `;
          tbody.appendChild(noResultsRow);
        } else if ((visibleCount > 0 || !searchTerm) && existingNoResults) {
          existingNoResults.remove();
        }
      });
      
      // Clear button functionality
      if (searchClear) {
        searchClear.addEventListener('click', function() {
          searchInput.value = '';
          searchInput.dispatchEvent(new Event('input'));
          searchInput.focus();
        });
      }
    }

    // 🔍 Search Functionality for Issued Items Table
    const searchIssuedInput = document.getElementById('searchIssuedInput');
    const searchIssuedClear = document.getElementById('searchIssuedClear');
    const searchIssuedResultsCount = document.getElementById('searchIssuedResultsCount');
    const issuedTableRows = document.querySelectorAll('.issued-item-row');
    const visibleIssuedRowsSpan = document.getElementById('visibleIssuedRows');
    
    if (searchIssuedInput) {
      searchIssuedInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        let visibleCount = 0;
        const totalCount = issuedTableRows.length;
        
        issuedTableRows.forEach(row => {
          const cells = row.querySelectorAll('td');
          const searchText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');
          
          if (searchText.includes(searchTerm)) {
            row.style.display = '';
            visibleCount++;
          } else {
            row.style.display = 'none';
          }
        });
        
        // Update visible count
        if (visibleIssuedRowsSpan) {
          visibleIssuedRowsSpan.textContent = visibleCount;
        }
        
        // Update search UI
        updateSearchUI(this, searchIssuedClear, searchIssuedResultsCount, visibleCount, totalCount);
        
        // Show/hide empty state
        const tbody = document.querySelector('#issuedTableContainer .stationary-table tbody');
        const existingNoResults = document.getElementById('no-issued-results');
        
        if (visibleCount === 0 && searchTerm && !existingNoResults) {
          const noResultsRow = document.createElement('tr');
          noResultsRow.id = 'no-issued-results';
          noResultsRow.innerHTML = `
            <td colspan="9" style="text-align:center; padding:40px; color:var(--muted);">
              <div style="font-size: 48px; margin-bottom: 15px;">🔍</div>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No issued items found</div>
              <div style="font-size: 14px;">Try adjusting your search terms</div>
            </td>
          `;
          tbody.appendChild(noResultsRow);
        } else if ((visibleCount > 0 || !searchTerm) && existingNoResults) {
          existingNoResults.remove();
        }
      });
      
      // Clear button functionality  
      if (searchIssuedClear) {
        searchIssuedClear.addEventListener('click', function() {
          searchIssuedInput.value = '';
          searchIssuedInput.dispatchEvent(new Event('input'));
          searchIssuedInput.focus();
        });
      }
    }

    // Expose functions to global scope
    window.showStockTable = showStockTable;
    window.showIssuedTable = showIssuedTable;
    
    // 🎨 Dynamic Quantity Color Coding
    function updateQuantityColors() {
      document.querySelectorAll('[data-quantity]').forEach(span => {
        const quantity = parseInt(span.getAttribute('data-quantity'));
        if (quantity < 10) {
          span.style.color = 'var(--danger)';
        } else if (quantity < 50) {
          span.style.color = '#f59e0b'; // Warning yellow
        } else {
          span.style.color = 'var(--success)';
        }
      });
    }
    
    // Apply color coding on page load
    updateQuantityColors();

    function setupToggle(buttonId, formId, openText, closeText) {
      const btn = document.getElementById(buttonId);
      const form = document.getElementById(formId);
      let visible = false;
      btn.addEventListener("click", () => {
        if (!visible) {
          form.style.display = "block";
          form.classList.remove("slide-up");
          form.classList.add("slide-down");
          btn.innerHTML = closeText;
        } else {
          form.classList.remove("slide-down");
          form.classList.add("slide-up");
          setTimeout(() => form.style.display = "none", 400);
          btn.innerHTML = openText;
        }
        visible = !visible;
      });
      return { btn, form, getVisible: () => visible };
    }

    const issueToggle = setupToggle("toggleIssueBtn", "issueForm", "📝 Issue Item", "❌ Close Issue");
    const stockToggle = setupToggle("toggleStockBtn", "stockForm", "📦 Add Stock", "❌ Close Stock");

    // Manage Add New vs Add Stock sections
    const addNewRadio = document.getElementById('addNewRadio');
    const addStockRadio = document.getElementById('addStockRadio');
    const newItemSection = document.getElementById('newItemSection');
    const existingItemSection = document.getElementById('existingItemSection');
    const submitText = document.getElementById('submitText');
    const categorySelect = document.getElementById('categorySelect');

    function updateStockFormSections() {
      if (addStockRadio.checked) {
        newItemSection.style.display = 'none';
        existingItemSection.style.display = 'block';
        submitText.textContent = '📥 Add Stock';
      } else {
        newItemSection.style.display = 'block';
        existingItemSection.style.display = 'none';
        submitText.textContent = '📥 Add New Item';
      }
    }

    addNewRadio.addEventListener('change', updateStockFormSections);
    addStockRadio.addEventListener('change', updateStockFormSections);

    // Prefill stock form for quick-add from table row
    function prefillAddStock(categoryId, categoryName) {
      // Ensure the stock form is visible
      const stockForm = document.getElementById('stockForm');
      if (stockForm.style.display === 'none' || stockForm.style.display === '') {
        // open it using the toggle button behavior
        stockForm.style.display = 'block';
        stockForm.classList.remove('slide-up');
        stockForm.classList.add('slide-down');
        document.getElementById('toggleStockBtn').innerHTML = '❌ Close Stock';
      }
      // switch to existing mode
      addStockRadio.checked = true;
      addNewRadio.checked = false;
      updateStockFormSections();
      // set the select value (if present)
      try {
        categorySelect.value = String(categoryId);
      } catch (e) {
        console.warn('Could not set category select', e);
      }
      // focus quantity input
      const qty = stockForm.querySelector('input[name="quantity"]');
      if (qty) qty.focus();
      // scroll into view
      stockForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Expose function to global scope for inline onclick handlers
    window.prefillAddStock = prefillAddStock;
    
    // Row editing functions
    function editRow(itemId) {
      const row = document.getElementById(`row-${itemId}`);
      if (!row) return;
      
      // Hide display mode, show edit mode
      row.querySelectorAll('.display-mode').forEach(el => el.style.display = 'none');
      row.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'inline-block');
      
      // Focus on quantity input
      const qtyInput = row.querySelector('.quantity-cell .edit-mode');
      if (qtyInput) qtyInput.focus();
    }
    
    function cancelEdit(itemId) {
      const row = document.getElementById(`row-${itemId}`);
      if (!row) return;
      
      // Reset input values to original
      const categoryDisplay = row.querySelector('.category-cell .display-mode').textContent;
      const quantityDisplay = row.querySelector('.quantity-cell .display-mode').textContent;
      
      row.querySelector('.category-cell .edit-mode').value = categoryDisplay;
      row.querySelector('.quantity-cell .edit-mode').value = quantityDisplay;
      
      // Show display mode, hide edit mode
      row.querySelectorAll('.display-mode').forEach(el => el.style.display = 'inline-block');
      row.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'none');
    }
    
    function saveRow(itemId) {
      const row = document.getElementById(`row-${itemId}`);
      if (!row) return;
      
      const quantityInput = row.querySelector('.quantity-cell .edit-mode');
      const quantity = quantityInput.value;
      
      // Validate quantity
      if (!quantity || quantity < 0) {
        alert('Please enter a valid quantity (0 or greater)');
        quantityInput.focus();
        return;
      }
      
      // Update the hidden form and submit
      const form = row.querySelector('.update-form');
      const hiddenQuantityInput = form.querySelector('.quantity-input');
      hiddenQuantityInput.value = quantity;
      
      // Submit the form
      form.submit();
    }
    
    // Add event listeners for table buttons
    document.addEventListener('DOMContentLoaded', function() {
      // Edit buttons
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const itemId = this.getAttribute('data-item-id');
          editRow(itemId);
        });
      });
      
      // Save buttons
      document.querySelectorAll('.save-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const itemId = this.getAttribute('data-item-id');
          saveRow(itemId);
        });
      });
      
      // Cancel buttons
      document.querySelectorAll('.cancel-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const itemId = this.getAttribute('data-item-id');
          cancelEdit(itemId);
        });
      });
      
      // Employee selection auto-fill
      const empSelect = document.getElementById('empSelect');
      const empName = document.getElementById('empName');
      const empEmail = document.getElementById('empEmail');
      const empGender = document.getElementById('empGender');
      const empEntity = document.getElementById('empEntity');
      const issueDate = document.getElementById('issueDate');
      const stationaryItem = document.getElementById('stationaryItem');
      const quantityIssued = document.getElementById('quantityIssued');
      const availableQty = document.getElementById('availableQty');
      
      // Set today's date as default
      if (issueDate) {
        const today = new Date().toISOString().split('T')[0];
        issueDate.value = today;
      }
      
      if (empSelect) {
        empSelect.addEventListener('change', function() {
          const selectedOption = this.options[this.selectedIndex];
          
          if (selectedOption.value) {
            // Auto-fill employee details from data attributes
            empName.value = selectedOption.getAttribute('data-name') || '';
            empEmail.value = selectedOption.getAttribute('data-email') || '';
            empGender.value = selectedOption.getAttribute('data-gender') || '';
            empEntity.value = selectedOption.getAttribute('data-entity') || '';
          } else {
            // Clear fields if no employee selected
            empName.value = '';
            empEmail.value = '';
            empGender.value = '';
            empEntity.value = '';
          }
        });
      }
      
      // Stationary item selection handler
      if (stationaryItem) {
        stationaryItem.addEventListener('change', function() {
          const selectedOption = this.options[this.selectedIndex];
          
          if (selectedOption.value) {
            const availableQuantity = selectedOption.getAttribute('data-available');
            if (availableQty) {
              availableQty.style.display = 'block';
              availableQty.textContent = `Available quantity: ${availableQuantity}`;
              
              // Set max attribute for quantity input
              if (quantityIssued) {
                quantityIssued.setAttribute('max', availableQuantity);
                quantityIssued.setAttribute('placeholder', `Max: ${availableQuantity}`);
              }
            }
          } else {
            if (availableQty) {
              availableQty.style.display = 'none';
            }
            if (quantityIssued) {
              quantityIssued.removeAttribute('max');
              quantityIssued.setAttribute('placeholder', 'Enter quantity');
            }
          }
        });
      }
      
      // Quantity validation
      if (quantityIssued) {
        quantityIssued.addEventListener('input', function() {
          const selectedItem = stationaryItem.options[stationaryItem.selectedIndex];
          if (selectedItem && selectedItem.value) {
            const availableQuantity = parseInt(selectedItem.getAttribute('data-available'));
            const requestedQuantity = parseInt(this.value);
            
            if (requestedQuantity > availableQuantity) {
              this.setCustomValidity(`Only ${availableQuantity} items available`);
              this.style.borderColor = 'var(--danger)';
            } else {
              this.setCustomValidity('');
              this.style.borderColor = 'var(--primary)';
            }
          }
        });
      }
    });
    
    // Initialize sections based on default radio
    updateStockFormSections();
    
    // Handle form submissions and update table dynamically
    const stockForm = document.getElementById('stockForm');
    if (stockForm) {
      stockForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const isNewType = document.getElementById('addNewRadio').checked;
        const actionUrl = isNewType ? 
          this.querySelector('button[formaction]').getAttribute('formaction') : 
          this.getAttribute('action');
        
        fetch(actionUrl, {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'Accept': 'application/json',
            'X-CSRFToken': formData.get('csrfmiddlewaretoken')
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Show success message
            showMessage('✅ ' + data.message, 'success');
            
            // Update table dynamically
            if (data.new_item) {
              addNewRowToTable(data.new_item);
              // Add new option to existing items dropdown
              addOptionToSelect(data.new_item.category_id, data.new_item.category_name);
              // Add new option to issue form stationary items
              addOptionToIssueForm(data.new_item.category_id, data.new_item.category_name);
            } else if (data.updated_item) {
              updateExistingRow(data.updated_item);
            }
            
            // Reset form
            this.reset();
            updateStockFormSections();
            
            // Close form
            document.getElementById('toggleStockBtn').click();
          } else {
            showMessage('❌ ' + (data.message || 'Operation failed'), 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showMessage('❌ An error occurred', 'error');
        });
      });
    }
    
    // Function to show messages
    function showMessage(message, type) {
      const messagesContainer = document.querySelector('.messages-container') || createMessagesContainer();
      const messageDiv = document.createElement('div');
      messageDiv.style.cssText = `
        background: ${type === 'success' ? '#dcfce7' : '#fee2e2'};
        color: ${type === 'success' ? '#166534' : '#991b1b'};
        border-left: 5px solid ${type === 'success' ? '#10b981' : '#ef4444'};
        padding: 10px 15px;
        border-radius: 6px;
        margin-bottom: 8px;
        animation: slideDown 0.3s ease;
      `;
      messageDiv.textContent = message;
      messagesContainer.appendChild(messageDiv);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        messageDiv.remove();
      }, 5000);
    }
    
    function createMessagesContainer() {
      const container = document.createElement('div');
      container.className = 'messages-container';
      container.style.cssText = 'max-width: 800px; margin: 10px auto;';
      document.querySelector('.navbar').insertAdjacentElement('afterend', container);
      return container;
    }
    
    // Function to add new row to table
    function addNewRowToTable(item) {
      const tbody = document.querySelector('.stationary-table tbody');
      const existingRows = tbody.querySelectorAll('tr:not([colspan])');
      const newRowNumber = existingRows.length + 1;
      
      // Remove "no items" message if exists
      const emptyRow = tbody.querySelector('tr[colspan]');
      if (emptyRow) emptyRow.remove();
      
      const newRow = document.createElement('tr');
      newRow.id = `row-${item.id}`;
      newRow.className = 'item-row';
      newRow.innerHTML = `
        <td style="font-weight: 600; color: var(--primary);">${newRowNumber}</td>
        <td class="category-cell">
          <span class="display-mode" style="font-weight: 500;">${item.category_name}</span>
          <input type="text" class="edit-mode" value="${item.category_name}" style="display:none; width:100%; padding:8px; border-radius:8px; border:1px solid #cbd5e1;">
        </td>
        <td style="text-align:right" class="quantity-cell">
          <span class="display-mode" style="font-weight: 600;" data-quantity="${item.quantity}">${item.quantity}</span>
          <input type="number" class="edit-mode" value="${item.quantity}" min="0" style="display:none; width:100px; padding:8px; border-radius:8px; border:1px solid #cbd5e1;">
        </td>
        <td style="text-align:right; color: var(--muted); font-size: 13px;">${item.updated_at}</td>
        <td class="actions-cell">
          <div class="display-mode">
            <button type="button" class="toggle-btn edit-btn" style="padding:8px 12px; font-size:12px; margin-right: 6px;" data-item-id="${item.id}">✏️ Edit</button>
          </div>
          <div class="edit-mode" style="display:none;">
            <button type="button" class="toggle-btn save-btn" style="padding:8px 12px; font-size:12px; margin-right:6px; background:var(--success);" data-item-id="${item.id}">💾 Save</button>
            <button type="button" class="toggle-btn cancel-btn" style="padding:8px 12px; font-size:12px; background:var(--muted);" data-item-id="${item.id}">❌ Cancel</button>
          </div>
          <form method="POST" action="/stationary/update-item/${item.id}/" style="display:none;" class="update-form">
            <input type="hidden" name="csrfmiddlewaretoken" value="${document.querySelector('[name=csrfmiddlewaretoken]').value}">
            <input type="hidden" name="quantity" class="quantity-input">
          </form>
        </td>
      `;
      
      tbody.appendChild(newRow);
      attachRowEventListeners(newRow);
      updateQuantityColors(); // Apply color coding to new row
    }
    
    // Function to update existing row
    function updateExistingRow(item) {
      const row = document.getElementById(`row-${item.id}`);
      if (row) {
        row.querySelector('.quantity-cell .display-mode').textContent = item.quantity;
        row.querySelector('.quantity-cell .edit-mode').value = item.quantity;
        row.querySelector('td:nth-child(4)').textContent = item.updated_at;
        updateQuantityColors(); // Update color coding
      }
    }
    
    // Function to add option to select dropdown
    function addOptionToSelect(categoryId, categoryName) {
      const categorySelect = document.getElementById('categorySelect');
      if (categorySelect) {
        const option = document.createElement('option');
        option.value = categoryId;
        option.textContent = categoryName;
        categorySelect.appendChild(option);
      }
    }
    
    // Function to add option to issue form
    function addOptionToIssueForm(categoryId, categoryName) {
      const stationaryItem = document.getElementById('stationaryItem');
      if (stationaryItem) {
        const option = document.createElement('option');
        option.value = categoryId;
        option.textContent = categoryName;
        stationaryItem.appendChild(option);
      }
    }
    
    // Function to attach event listeners to new rows
    function attachRowEventListeners(row) {
      const editBtn = row.querySelector('.edit-btn');
      const saveBtn = row.querySelector('.save-btn');
      const cancelBtn = row.querySelector('.cancel-btn');
      
      if (editBtn) {
        editBtn.addEventListener('click', function() {
          const itemId = this.getAttribute('data-item-id');
          editRow(itemId);
        });
      }
      
      if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          const itemId = this.getAttribute('data-item-id');
          saveRow(itemId);
        });
      }
      
      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          const itemId = this.getAttribute('data-item-id');
          cancelEdit(itemId);
        });
      }
    }
  </script>
</body>
</html>